<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FGSheets | Demo</title>
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>

    <header class="header">
        <h1>FGSheets</h1>
        <p>Demonstração de Solução</p>
    </header>

    <main>
        <section class="presentation">
            <form id="main-form" class="presentation_form" action="">
                <div class="presentation_form_line">
                    <label for="">Nick</label>
                    <input type="text" name="Nick">
                </div>

                <div class="presentation_form_line">
                    <label for="">Emoção</label>
                    <select id="" name="Emoção" required>
                        <option value=""></option>
                        <option value="Animado">Animado</option>
                        <option value="Curioso">Curioso</option>
                        <option value="Desconfiado">Desconfiado</option>
                    </select>
                </div>

                <div class="presentation_form_line">
                    <label for="">Comentário</label>
                    <textarea id="" name="Comentário"></textarea>
                </div>

                <div class="presentation_form_controls">
                    <button>Limpar</button>
                    <button>Enviar</button>
                </div>

                <span id="message-box" class="--hidden"></span>

            </form>
        </section>


        <section class="content">
            <table>
                <tr>
                    <th>Nick</th>
                    <th>Emoção</th>
                    <th>Comentário</th>
                    <th>Data</th>
            </table>
        </section>

    </main>

    <footer>
        <div>Lúcio Carvalho Almeida</div>
        <div>
            <a href="https://github.com/LucioCarvalhoDev">Github</a><span>&ThickSpace;;</span>
            <a href="https://www.linkedin.com/in/l%C3%BAcio-carvalho-almeida-0599881b0/">Linkedin</a>
        </div>
    </footer>
    
    <script src="js/messengerController.js"></script>
    <script>
        const gsheetURL = new URL("https://script.google.com/macros/s/AKfycbx0lXXeSM0hq7Ogt7Qxl_nc45pi_skDNAwnzdNDJH13ZPMvu9yX8LXCjxqfzO0zSbzB9Q/exec");

        const form = document.forms['main-form'];
        const messenger = new MessengerController(document.getElementById("message-box"));
        const contentContainer = document.querySelector('.content');

        async function loadForum() {
            const response = await fetch(gsheetURL.toString(), {
                method: "GET",
                redirect: "follow"
            });

            contentContainer.innerHTML = await response.text();
        }

        loadForum();

        form.addEventListener("submit", async (event) => {
            event.preventDefault();

            formData = new FormData(form);
            payload = {};

            for (element of formData.keys()) {
                payload[element] = formData.get(element)
            }

            console.log(payload)

            try {
                messenger.postMessage("Enviando...");
                form.reset();

                const response = await fetch(gsheetURL.toString(), {
                    redirect: "follow",
                    method: "POST",
                    body: JSON.stringify(payload),
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8",
                    }
                });

                const data = await response.json();

                if (data.status = "success") {
                    messenger.postMessage(data.message, 2000);

                    loadForum();
                } else {
                    messenger.postMessage(data.message, 5000)
                }

            } catch (error) {
                messenger.postMessage(error, 6000);
            }

        })
    </script>
</body>

</html>